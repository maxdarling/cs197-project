#ifndef MOBIUS_HPP
#define MOBIUS_HPP

/* anfs.c
 *
 * Statistical Mobius Analysis
 *
 * As described in "A New Statistical Testing for Symmetric Ciphers and
 * Hash Functions", Eric Filiol, July 23, 2002
 *
 * Danko Ilik, 2003
 *
 */

#include "HashTestCommons.hpp";


/* defines the intervals for the 3 classes of output ANFS
 * for the T_2 tests. Note that the original paper paper
 * (cited in the begining of anfs.c) does not provide strict
 * guidelines for creation of the ni classes (2<=ni<=9), but
 * the experiments carried out by the author worked on 3 classes
 * such as, for 160-bit hash funstions the espected number of ANFs
 * that fall into the 1st and 3rd class is 30, and for the 2nd it is
 * 100. 30+100+30=160. We extrapolate this practice, as can be seen
 * in the Maple worksheet anf.mws; and here we give a table for
 * output bitlenghts from 8 to 2048 bits. (1 to 256 bytes)
 * And we do that for each possible degree being tested (1..3)
 */
double class_delimiters[3][256][2] = {
        // DEGREE 1:
        {
                {2.745385,5.254615},
                {6.225707,9.774293},
                {9.826944,14.173056},
                {13.490771,18.509229},
                {17.194596,22.805404},
                {20.926834,27.073166},
                {24.680602,31.319398},
                {28.451414,35.548586},
                {32.236156,39.763844},
                {36.032560,43.967440},
                {39.838914,48.161086},
                {43.653887,52.346113},
                {47.476422,56.523578},
                {51.305662,60.694338},
                {55.140898,64.859102},
                {58.981541,69.018459},
                {62.827091,73.172909},
                {66.677121,77.322879},
                {70.531261,81.468739},
                {74.389193,85.610807},
                {78.250633,89.749367},
                {82.115335,93.884665},
                {85.983079,98.016921},
                {89.853668,102.146332},
                {93.726927,106.273074},
                {97.602695,110.397305},
                {101.480831,114.519169},
                {105.361203,118.638797},
                {109.243693,122.756307},
                {113.128192,126.871808},
                {117.014601,130.985399},
                {120.902828,135.097173},
                {124.792787,139.207213},
                {128.684402,143.315598},
                {132.577599,147.422401},
                {136.472312,151.527688},
                {140.368477,155.631523},
                {144.266036,159.733964},
                {148.164934,163.835066},
                {152.065120,167.934880},
                {155.966546,172.033454},
                {159.869168,176.130833},
                {163.772941,180.227059},
                {167.677828,184.322172},
                {171.583789,188.416211},
                {175.490789,192.509211},
                {179.398795,196.601205},
                {183.307774,200.692226},
                {187.217697,204.782303},
                {191.128534,208.871466},
                {195.040259,212.959741},
                {198.952845,217.047155},
                {202.866267,221.133733},
                {206.780503,225.219498},
                {210.695528,229.304472},
                {214.611323,233.388677},
                {218.527867,237.472133},
                {222.445139,241.554861},
                {226.363122,245.636878},
                {230.281796,249.718204},
                {234.201146,253.798854},
                {238.121154,257.878846},
                {242.041805,261.958195},
                {245.963082,266.036918},
                {249.884973,270.115027},
                {253.807462,274.192538},
                {257.730536,278.269464},
                {261.654182,282.345818},
                {265.578388,286.421612},
                {269.503140,290.496860},
                {273.428429,294.571571},
                {277.354241,298.645759},
                {281.280567,302.719433},
                {285.207396,306.792604},
                {289.134718,310.865282},
                {293.062523,314.937477},
                {296.990801,319.009199},
                {300.919543,323.080457},
                {304.848741,327.151259},
                {308.778385,331.221615},
                {312.708468,335.291532},
                {316.638981,339.361019},
                {320.569916,343.430084},
                {324.501266,347.498734},
                {328.433024,351.566976},
                {332.365182,355.634818},
                {336.297733,359.702267},
                {340.230671,363.769329},
                {344.163989,367.836011},
                {348.097680,371.902320},
                {352.031739,375.968261},
                {355.966159,380.033841},
                {359.900934,384.099066},
                {363.836059,388.163941},
                {367.771529,392.228471},
                {371.707337,396.292663},
                {375.643478,400.356522},
                {379.579948,404.420052},
                {383.516741,408.483259},
                {387.453853,412.546147},
                {391.391278,416.608722},
                {395.329013,420.670987},
                {399.267052,424.732949},
                {403.205390,428.794610},
                {407.144025,432.855975},
                {411.082951,436.917049},
                {415.022165,440.977835},
                {418.961662,445.038338},
                {422.901438,449.098562},
                {426.841490,453.158510},
                {430.781814,457.218186},
                {434.722406,461.277594},
                {438.663263,465.336737},
                {442.604381,469.395619},
                {446.545756,473.454244},
                {450.487386,477.512614},
                {454.429267,481.570733},
                {458.371396,485.628604},
                {462.313770,489.686231},
                {466.256385,493.743615},
                {470.199238,497.800762},
                {474.142328,501.857672},
                {478.085650,505.914350},
                {482.029202,509.970798},
                {485.972981,514.027019},
                {489.916985,518.083015},
                {493.861210,522.138790},
                {497.805655,526.194345},
                {501.750316,530.249684},
                {505.695192,534.304808},
                {509.640279,538.359722},
                {513.585575,542.414425},
                {517.531078,546.468923},
                {521.476785,550.523215},
                {525.422695,554.577306},
                {529.368804,558.631196},
                {533.315112,562.684889},
                {537.261614,566.738386},
                {541.208311,570.791689},
                {545.155199,574.844801},
                {549.102276,578.897724},
                {553.049540,582.950460},
                {556.996990,587.003010},
                {560.944624,591.055376},
                {564.892439,595.107562},
                {568.840433,599.159567},
                {572.788605,603.211395},
                {576.736954,607.263047},
                {580.685476,611.314524},
                {584.634171,615.365829},
                {588.583037,619.416964},
                {592.532071,623.467929},
                {596.481273,627.518727},
                {600.430641,631.569359},
                {604.380173,635.619827},
                {608.329868,639.670133},
                {612.279723,643.720277},
                {616.229738,647.770262},
                {620.179911,651.820089},
                {624.130240,655.869760},
                {628.080724,659.919276},
                {632.031362,663.968638},
                {635.982152,668.017848},
                {639.933093,672.066908},
                {643.884182,676.115818},
                {647.835420,680.164580},
                {651.786805,684.213195},
                {655.738335,688.261665},
                {659.690009,692.309991},
                {663.641826,696.358174},
                {667.593784,700.406216},
                {671.545883,704.454118},
                {675.498120,708.501880},
                {679.450496,712.549505},
                {683.403008,716.596992},
                {687.355655,720.644345},
                {691.308437,724.691563},
                {695.261352,728.738648},
                {699.214399,732.785601},
                {703.167578,736.832423},
                {707.120886,740.879114},
                {711.074322,744.925678},
                {715.027887,748.972113},
                {718.981578,753.018422},
                {722.935395,757.064605},
                {726.889337,761.110663},
                {730.843402,765.156598},
                {734.797590,769.202410},
                {738.751900,773.248100},
                {742.706330,777.293670},
                {746.660880,781.339120},
                {750.615549,785.384451},
                {754.570336,789.429664},
                {758.525239,793.474761},
                {762.480259,797.519741},
                {766.435394,801.564606},
                {770.390644,805.609356},
                {774.346006,809.653994},
                {778.301482,813.698518},
                {782.257069,817.742931},
                {786.212767,821.787233},
                {790.168575,825.831425},
                {794.124492,829.875508},
                {798.080518,833.919482},
                {802.036651,837.963349},
                {805.992892,842.007109},
                {809.949238,846.050762},
                {813.905690,850.094311},
                {817.862246,854.137754},
                {821.818906,858.181094},
                {825.775669,862.224331},
                {829.732534,866.267466},
                {833.689501,870.310499},
                {837.646569,874.353431},
                {841.603737,878.396263},
                {845.561005,882.438995},
                {849.518372,886.481629},
                {853.475836,890.524164},
                {857.433398,894.566602},
                {861.391057,898.608943},
                {865.348812,902.651188},
                {869.306662,906.693338},
                {873.264607,910.735393},
                {877.222647,914.777353},
                {881.180780,918.819220},
                {885.139005,922.860995},
                {889.097324,926.902676},
                {893.055734,930.944267},
                {897.014235,934.985766},
                {900.972826,939.027174},
                {904.931508,943.068493},
                {908.890278,947.109722},
                {912.849138,951.150862},
                {916.808086,955.191915},
                {920.767121,959.232879},
                {924.726243,963.273757},
                {928.685452,967.314548},
                {932.644747,971.355253},
                {936.604128,975.395873},
                {940.563593,979.436407},
                {944.523142,983.476858},
                {948.482776,987.517224},
                {952.442492,991.557508},
                {956.402292,995.597708},
                {960.362174,999.637826},
                {964.322137,1003.677863},
                {968.282182,1007.717818},
                {972.242308,1011.757692},
                {976.202514,1015.797486},
                {980.162800,1019.837200},
                {984.123165,1023.876835},
                {988.083609,1027.916391},
                {992.044132,1031.955868},
                {996.004732,1035.995268},
                {999.965410,1040.034590},
                {1003.926165,1044.073835}
        },

        // DEGREE 2:
        {
                {11.652831,16.347169},
                {55.140898,64.859102},
                {130.630807,145.369193},
                {238.121154,257.878846},
                {377.611673,402.388328},
                {549.102276,578.897724},
                {752.592928,787.407073},
                {988.083609,1027.916391},
                {1255.574311,1300.425689},
                {1555.065026,1604.934974},
                {1886.555752,1941.444248},
                {2250.046485,2309.953515},
                {2645.537224,2710.462776},
                {3073.027967,3142.972033},
                {3532.518714,3607.481286},
                {4024.009464,4103.990536},
                {4547.500217,4632.499783},
                {5102.990971,5193.009029},
                {5690.481727,5785.518273},
                {6309.972485,6410.027515},
                {6961.463244,7066.536756},
                {7644.954004,7755.045996},
                {8360.444765,8475.555235},
                {9107.935526,9228.064474},
                {9887.426289,10012.573710},
                {10698.917050,10829.082950},
                {11542.407820,11677.592180},
                {12417.898580,12558.101420},
                {13325.389340,13470.610660},
                {14264.880110,14415.119890},
                {15236.370870,15391.629130},
                {16239.861640,16400.138360},
                {17275.352410,17440.647590},
                {18342.843170,18513.156830},
                {19442.333940,19617.666060},
                {20573.824710,20754.175290},
                {21737.315470,21922.684530},
                {22932.806240,23123.193760},
                {24160.297010,24355.702990},
                {25419.787770,25620.212230},
                {26711.278540,26916.721460},
                {28034.769310,28245.230690},
                {29390.260080,29605.739920},
                {30777.750850,30998.249150},
                {32197.241610,32422.758390},
                {33648.732380,33879.267620},
                {35132.223150,35367.776850},
                {36647.713920,36888.286080},
                {38195.204690,38440.795310},
                {39774.695460,40025.304540},
                {41386.186220,41641.813780},
                {43029.676990,43290.323010},
                {44705.167760,44970.832240},
                {46412.658530,46683.341470},
                {48152.149300,48427.850700},
                {49923.640070,50204.359930},
                {51727.130840,52012.869160},
                {53562.621610,53853.378390},
                {55430.112380,55725.887620},
                {57329.603150,57630.396850},
                {59261.093910,59566.906090},
                {61224.584680,61535.415320},
                {63220.075450,63535.924550},
                {65247.566220,65568.433780},
                {67307.056990,67632.943010},
                {69398.547760,69729.452240},
                {71522.038530,71857.961470},
                {73677.529300,74018.470700},
                {75865.020070,76210.979930},
                {78084.510840,78435.489160},
                {80336.001610,80691.998390},
                {82619.492380,82980.507620},
                {84934.983150,85301.016850},
                {87282.473920,87653.526080},
                {89661.964690,90038.035310},
                {92073.455460,92454.544540},
                {94516.946230,94903.053770},
                {96992.437000,97383.563000},
                {99499.927770,99896.072230},
                {102039.418500,102440.581500},
                {104610.909300,105017.090700},
                {107214.400100,107625.599900},
                {109849.890800,110266.109200},
                {112517.381600,112938.618400},
                {115216.872400,115643.127600},
                {117948.363200,118379.636800},
                {120711.853900,121148.146100},
                {123507.344700,123948.655300},
                {126334.835500,126781.164500},
                {129194.326200,129645.673800},
                {132085.817000,132542.183000},
                {135009.307800,135470.692200},
                {137964.798500,138431.201500},
                {140952.289300,141423.710700},
                {143971.780100,144448.219900},
                {147023.270900,147504.729100},
                {150106.761600,150593.238400},
                {153222.252400,153713.747600},
                {156369.743200,156866.256800},
                {159549.233900,160050.766100},
                {162760.724700,163267.275300},
                {166004.215500,166515.784500},
                {169279.706200,169796.293800},
                {172587.197000,173108.803000},
                {175926.687800,176453.312200},
                {179298.178600,179829.821400},
                {182701.669300,183238.330700},
                {186137.160100,186678.839900},
                {189604.650900,190151.349100},
                {193104.141600,193655.858400},
                {196635.632400,197192.367600},
                {200199.123200,200760.876800},
                {203794.613900,204361.386100},
                {207422.104700,207993.895300},
                {211081.595500,211658.404500},
                {214773.086300,215354.913700},
                {218496.577000,219083.423000},
                {222252.067800,222843.932200},
                {226039.558600,226636.441400},
                {229859.049300,230460.950700},
                {233710.540100,234317.459900},
                {237594.030900,238205.969100},
                {241509.521700,242126.478300},
                {245457.012400,246078.987600},
                {249436.503200,250063.496800},
                {253447.994000,254080.006000},
                {257491.484700,258128.515300},
                {261566.975500,262209.024500},
                {265674.466300,266321.533700},
                {269813.957000,270466.043000},
                {273985.447800,274642.552200},
                {278188.938600,278851.061400},
                {282424.429400,283091.570600},
                {286691.920100,287364.079900},
                {290991.410900,291668.589100},
                {295322.901700,296005.098300},
                {299686.392400,300373.607600},
                {304081.883200,304774.116800},
                {308509.374000,309206.626000},
                {312968.864700,313671.135300},
                {317460.355500,318167.644500},
                {321983.846300,322696.153700},
                {326539.337100,327256.662900},
                {331126.827800,331849.172200},
                {335746.318600,336473.681400},
                {340397.809400,341130.190600},
                {345081.300100,345818.699900},
                {349796.790900,350539.209100},
                {354544.281700,355291.718300},
                {359323.772500,360076.227500},
                {364135.263200,364892.736800},
                {368978.754000,369741.246000},
                {373854.244800,374621.755200},
                {378761.735500,379534.264500},
                {383701.226300,384478.773700},
                {388672.717100,389455.282900},
                {393676.207800,394463.792200},
                {398711.698600,399504.301400},
                {403779.189400,404576.810600},
                {408878.680200,409681.319800},
                {414010.170900,414817.829100},
                {419173.661700,419986.338300},
                {424369.152500,425186.847500},
                {429596.643200,430419.356800},
                {434856.134000,435683.866000},
                {440147.624800,440980.375200},
                {445471.115500,446308.884500},
                {450826.606300,451669.393700},
                {456214.097100,457061.902900},
                {461633.587900,462486.412100},
                {467085.078600,467942.921400},
                {472568.569400,473431.430600},
                {478084.060200,478951.939800},
                {483631.550900,484504.449100},
                {489211.041700,490088.958300},
                {494822.532500,495705.467500},
                {500466.023300,501353.976700},
                {506141.514000,507034.486000},
                {511849.004800,512746.995200},
                {517588.495600,518491.504400},
                {523359.986300,524268.013700},
                {529163.477100,530076.522900},
                {534998.967900,535917.032100},
                {540866.458600,541789.541400},
                {546765.949400,547694.050600},
                {552697.440200,553630.559800},
                {558660.931000,559599.069000},
                {564656.421700,565599.578300},
                {570683.912500,571632.087500},
                {576743.403300,577696.596700},
                {582834.894000,583793.106000},
                {588958.384800,589921.615200},
                {595113.875600,596082.124400},
                {601301.366400,602274.633600},
                {607520.857100,608499.142900},
                {613772.347900,614755.652100},
                {620055.838700,621044.161300},
                {626371.329400,627364.670600},
                {632718.820200,633717.179800},
                {639098.311000,640101.689000},
                {645509.801700,646518.198300},
                {651953.292500,652966.707500},
                {658428.783300,659447.216700},
                {664936.274100,665959.725900},
                {671475.764800,672504.235200},
                {678047.255600,679080.744400},
                {684650.746400,685689.253600},
                {691286.237100,692329.762900},
                {697953.727900,699002.272100},
                {704653.218700,705706.781300},
                {711384.709400,712443.290600},
                {718148.200200,719211.799800},
                {724943.691000,726012.309000},
                {731771.181800,732844.818200},
                {738630.672500,739709.327500},
                {745522.163300,746605.836700},
                {752445.654100,753534.345900},
                {759401.144800,760494.855200},
                {766388.635600,767487.364400},
                {773408.126400,774511.873600},
                {780459.617200,781568.382800},
                {787543.107900,788656.892100},
                {794658.598700,795777.401300},
                {801806.089500,802929.910500},
                {808985.580200,810114.419800},
                {816197.071000,817330.929000},
                {823440.561800,824579.438200},
                {830716.052500,831859.947500},
                {838023.543300,839172.456700},
                {845363.034100,846516.965900},
                {852734.524900,853893.475100},
                {860138.015600,861301.984400},
                {867573.506400,868742.493600},
                {875040.997200,876215.002800},
                {882540.487900,883719.512100},
                {890071.978700,891256.021300},
                {897635.469500,898824.530500},
                {905230.960300,906425.039700},
                {912858.451000,914057.549000},
                {920517.941800,921722.058200},
                {928209.432600,929418.567400},
                {935932.923300,937147.076700},
                {943688.414100,944907.585900},
                {951475.904900,952700.095100},
                {959295.395600,960524.604400},
                {967146.886400,968381.113600},
                {975030.377200,976269.622800},
                {982945.868000,984190.132000},
                {990893.358700,992142.641300},
                {998872.849500,1000127.150000},
                {1006884.340000,1008143.660000},
                {1014927.831000,1016192.169000},
                {1023003.322000,1024272.678000},
                {1031110.813000,1032385.187000},
                {1039250.303000,1040529.697000},
                {1047421.794000,1048706.206000}
        },

        // DEGREE 3:
        {
                {24.680602,31.319398},
                {269.503140,290.496860},
                {992.044132,1031.955868},
                {2448.760346,2511.239654},
                {4895.909619,4984.090381},
                {8589.663789,8706.336211},
                {13786.148050,13933.851950},
                {20741.458880,20922.541120},
                {29711.673630,29928.326370},
                {40952.856080,41207.143920},
                {54721.060030,55014.939970},
                {71272.331650,71607.668350},
                {90862.711110,91241.288890},
                {113748.233800,114171.766200},
                {140184.931300,140655.068700},
                {170428.831700,170947.168300},
                {204735.960700,205304.039300},
                {243362.341400,243981.658600},
                {286563.995100,287236.004900},
                {334596.941300,335323.058700},
                {387717.198100,388498.801900},
                {446180.782200,447019.217800},
                {510243.709100,511140.290900},
                {580161.993400,581118.006600},
                {656191.648800,657208.351200},
                {738588.687900,739667.312100},
                {827609.122700,828750.877300},
                {923508.964800,924715.035200},
                {1026544.225000,1027815.775000},
                {1136970.913000,1138309.087000},
                {1255045.038000,1256450.962000},
                {1381022.611000,1382497.389000},
                {1515159.639000,1516704.361000},
                {1657712.131000,1659327.869000},
                {1808936.096000,1810623.904000},
                {1969087.539000,1970848.461000},
                {2138422.470000,2140257.530000},
                {2317196.895000,2319107.105000},
                {2505666.820000,2507653.180000},
                {2704088.252000,2706151.748000},
                {2912717.198000,2914858.802000},
                {3131809.662000,3134030.338000},
                {3361621.652000,3363922.348000},
                {3602409.173000,3604790.827000},
                {3854428.230000,3856891.770000},
                {4117934.828000,4120481.172000},
                {4393184.972000,4395815.028000},
                {4680434.667000,4683149.333000},
                {4979939.918000,4982740.082000},
                {5291956.730000,5294843.270000},
                {5616741.106000,5619714.894000},
                {5954549.051000,5957610.949000},
                {6305636.570000,6308787.430000},
                {6670259.666000,6673500.334000},
                {7048674.344000,7052005.656000},
                {7441136.606000,7444559.394000},
                {7847902.458000,7851417.542000},
                {8269227.902000,8272836.098000},
                {8705368.942000,8709071.058000},
                {9156581.581000,9160378.419000},
                {9623121.823000,9627014.177000},
                {10105245.670000,10109234.330000},
                {10603209.130000,10607294.870000},
                {11117268.200000,11121451.800000},
                {11647678.890000,11651961.110000},
                {12194697.190000,12199078.810000},
                {12758579.110000,12763060.890000},
                {13339580.660000,13344163.340000},
                {13937957.840000,13942642.160000},
                {14553966.650000,14558753.350000},
                {15187863.090000,15192752.910000},
                {15839903.160000,15844896.840000},
                {16510342.870000,16515441.130000},
                {17199438.220000,17204641.780000},
                {17907445.210000,17912754.790000},
                {18634619.850000,18640036.150000},
                {19381218.140000,19386741.860000},
                {20147496.070000,20153127.930000},
                {20933709.660000,20939450.340000},
                {21740114.900000,21745965.100000},
                {22566967.800000,22572928.200000},
                {23414524.350000,23420595.650000},
                {24283040.570000,24289223.430000},
                {25172772.450000,25179067.550000},
                {26083975.990000,26090384.010000},
                {27016907.200000,27023428.800000},
                {27971822.080000,27978457.920000},
                {28948976.620000,28955727.380000},
                {29948626.840000,29955493.160000},
                {30971028.740000,30978011.260000},
                {32016438.310000,32023537.690000},
                {33085111.550000,33092328.450000},
                {34177304.480000,34184639.520000},
                {35293273.090000,35300726.910000},
                {36433273.380000,36440846.620000},
                {37597561.350000,37605254.650000},
                {38786393.010000,38794206.990000},
                {40000024.360000,40007959.640000},
                {41238711.400000,41246768.600000},
                {42502710.130000,42510889.870000},
                {43792276.550000,43800579.450000},
                {45107666.670000,45116093.330000},
                {46449136.480000,46457687.520000},
                {47816941.990000,47825618.010000},
                {49211339.190000,49220140.810000},
                {50632584.100000,50641511.900000},
                {52080932.710000,52089987.290000},
                {53556641.020000,53565822.980000},
                {55059965.030000,55069274.970000},
                {56591160.750000,56600599.250000},
                {58150484.180000,58160051.820000},
                {59738191.310000,59747888.690000},
                {61354538.160000,61364365.840000},
                {62999780.710000,63009739.290000},
                {64674174.980000,64684265.020000},
                {66377976.960000,66388199.040000},
                {68111442.660000,68121797.340000},
                {69874828.070000,69885315.930000},
                {71668389.200000,71679010.800000},
                {73492382.040000,73503137.960000},
                {75347062.610000,75357953.390000},
                {77232686.890000,77243713.110000},
                {79149510.900000,79160673.100000},
                {81097790.630000,81109089.370000},
                {83077782.080000,83089217.920000},
                {85089741.260000,85101314.740000},
                {87133924.170000,87145635.830000},
                {89210586.800000,89222437.200000},
                {91319985.160000,91331974.840000},
                {93462375.250000,93474504.750000},
                {95638013.070000,95650282.930000},
                {97847154.620000,97859565.380000},
                {100090055.900000,100102608.100000},
                {102366972.900000,102379667.100000},
                {104678161.700000,104690998.300000},
                {107023878.200000,107036857.800000},
                {109404378.400000,109417501.600000},
                {111819918.300000,111833185.700000},
                {114270754.000000,114284166.000000},
                {116757141.500000,116770698.500000},
                {119279336.700000,119293039.300000},
                {121837595.600000,121851444.400000},
                {124432174.200000,124446169.800000},
                {127063328.600000,127077471.400000},
                {129731314.800000,129745605.200000},
                {132436388.700000,132450827.300000},
                {135178806.300000,135193393.700000},
                {137958823.700000,137973560.300000},
                {140776696.800000,140791583.200000},
                {143632681.700000,143647718.300000},
                {146527034.400000,146542221.600000},
                {149460010.700000,149475349.300000},
                {152431866.900000,152447357.100000},
                {155442858.700000,155458501.300000},
                {158493242.400000,158509037.600000},
                {161583273.800000,161599222.200000},
                {164713208.900000,164729311.100000},
                {167883303.800000,167899560.200000},
                {171093814.400000,171110225.600000},
                {174344996.900000,174361563.100000},
                {177637107.000000,177653829.000000},
                {180970400.900000,180987279.100000},
                {184345134.600000,184362169.400000},
                {187761564.100000,187778755.900000},
                {191219945.300000,191237294.700000},
                {194720534.200000,194738041.800000},
                {198263586.900000,198281253.100000},
                {201849359.400000,201867184.600000},
                {205478107.700000,205496092.300000},
                {209150087.700000,209168232.300000},
                {212865555.400000,212883860.600000},
                {216624767.000000,216643233.000000},
                {220427978.300000,220446605.700000},
                {224275445.400000,224294234.600000},
                {228167424.200000,228186375.800000},
                {232104170.800000,232123285.200000},
                {236085941.200000,236105218.800000},
                {240112991.300000,240132432.700000},
                {244185577.200000,244205182.800000},
                {248303954.900000,248323725.100000},
                {252468380.400000,252488315.600000},
                {256679109.600000,256699210.400000},
                {260936398.600000,260956665.400000},
                {265240503.300000,265260936.700000},
                {269591679.900000,269612280.100000},
                {273990184.200000,274010951.800000},
                {278436272.300000,278457207.700000},
                {282930200.200000,282951303.800000},
                {287472223.800000,287493496.200000},
                {292062599.200000,292084040.800000},
                {296701582.400000,296723193.600000},
                {301389429.400000,301411210.600000},
                {306126396.100000,306148347.900000},
                {310912738.700000,310934861.300000},
                {315748713.000000,315771007.000000},
                {320634575.100000,320657040.900000},
                {325570580.900000,325593219.100000},
                {330556986.600000,330579797.400000},
                {335594048.000000,335617032.000000},
                {340682021.200000,340705178.800000},
                {345821162.200000,345844493.800000},
                {351011727.000000,351035233.000000},
                {356253971.600000,356277652.400000},
                {361548151.900000,361572008.100000},
                {366894524.100000,366918555.900000},
                {372293344.000000,372317552.000000},
                {377744867.700000,377769252.300000},
                {383249351.200000,383273912.800000},
                {388807050.400000,388831789.600000},
                {394418221.500000,394443138.500000},
                {400083120.400000,400108215.600000},
                {405802003.000000,405827277.000000},
                {411575125.400000,411600578.600000},
                {417402743.600000,417428376.400000},
                {423285113.600000,423310926.400000},
                {429222491.400000,429248484.600000},
                {435215133.000000,435241307.000000},
                {441263294.400000,441289649.600000},
                {447367231.600000,447393768.400000},
                {453527200.600000,453553919.400000},
                {459743457.300000,459770358.700000},
                {466016257.900000,466043342.100000},
                {472345858.200000,472373125.800000},
                {478732514.300000,478759965.700000},
                {485176482.300000,485204117.700000},
                {491678018.000000,491705838.000000},
                {498237377.500000,498265382.500000},
                {504854816.900000,504883007.100000},
                {511530592.000000,511558968.000000},
                {518264958.900000,518293521.100000},
                {525058173.600000,525086922.400000},
                {531910492.100000,531939427.900000},
                {538822170.400000,538851293.600000},
                {545793464.500000,545822775.500000},
                {552824630.400000,552854129.600000},
                {559915924.100000,559945611.900000},
                {567067601.600000,567097478.400000},
                {574279918.900000,574309985.100000},
                {581553132.000000,581583388.000000},
                {588887496.900000,588917943.100000},
                {596283269.600000,596313906.400000},
                {603740706.100000,603771533.900000},
                {611260062.500000,611291081.500000},
                {618841594.600000,618872805.400000},
                {626485558.500000,626516961.500000},
                {634192210.200000,634223805.800000},
                {641961805.700000,641993594.300000},
                {649794601.100000,649826582.900000},
                {657690852.200000,657723027.800000},
                {665650815.100000,665683184.900000},
                {673674745.900000,673707310.100000},
                {681762900.400000,681795659.600000},
                {689915534.800000,689948489.200000},
                {698132905.000000,698166055.000000},
                {706415266.900000,706448613.100000},
                {714762876.700000,714796419.300000}
        }
};


/*
 * For more information on producing the following se the
 * Maple worksheet chisquare.mws
 *
 */

/* chi^2 with 2 degrees of freedom for significance levels
 * 0.05, 0.01 and 0.001
 */
double chi_square_2[3] = {5.991464547, 9.210340372, 13.81551056};

/* A table of theoretical values for the Chi-square distribution with
 * degrees of freedom (8-1)=7, (16-1)=15, (24-1)=23, ..., (2048-1)=2047;
 * for significance levels 0.05, 0.01 and 0.001. (corresponding to the 3
 * columns in the table)
 *
 * Used for the T_1 test which employs a Chi^2 test with outputbits-1
 * degrees of freedom.
 */
double chi_square_8to2048[256][3] =
        {
                {14.067140,18.475307,24.321886},
                {24.995790,30.577914,37.697298},
                {35.172462,41.638398,49.728232},
                {44.985343,52.191395,61.098306},
                {54.572228,62.428121,72.054663},
                {64.001112,72.443307,82.720423},
                {73.311493,82.292117,93.167533},
                {82.528727,92.010024,103.442377},
                {91.670239,101.621441,113.576936},
                {100.748619,111.144019,123.594366},
                {109.773309,120.591015,133.512074},
                {118.751612,129.972679,143.343540},
                {127.689308,139.297137,153.099454},
                {136.591071,148.570958,162.788463},
                {145.460740,157.799541,172.417682},
                {154.301516,166.987390,181.993045},
                {163.116101,176.138307,191.519568},
                {171.906799,185.255537,201.001529},
                {180.675597,194.341876,210.442620},
                {189.424220,203.399752,219.846046},
                {198.154177,212.431294,229.214617},
                {206.866798,221.438375,238.550806},
                {215.563263,230.422656,247.856811},
                {224.244624,239.385621,257.134589},
                {232.911822,248.328596,266.385895},
                {241.565705,257.252777,275.612310},
                {250.207041,266.159246,284.815263},
                {258.836525,275.048983,293.996052},
                {267.454791,283.922882,303.155857},
                {276.062417,292.781760,312.295760},
                {284.659936,301.626366,321.416752},
                {293.247835,310.457388,330.519744},
                {301.826565,319.275462,339.605576},
                {310.396541,328.081175,348.675025},
                {318.958149,336.875071,357.728811},
                {327.511748,345.657655,366.767604},
                {336.057670,354.429397,375.792024},
                {344.596227,363.190735,384.802654},
                {353.127708,371.942081,393.800035},
                {361.652385,380.683816,402.784675},
                {370.170514,389.416300,411.757051},
                {378.682332,398.139872,420.717609},
                {387.188067,406.854849,429.666771},
                {395.687929,415.561530,438.604932},
                {404.182118,424.260197,447.532467},
                {412.670824,432.951118,456.449728},
                {421.154224,441.634543,465.357051},
                {429.632488,450.310713,474.254750},
                {438.105777,458.979852,483.143126},
                {446.574242,467.642177,492.022464},
                {455.038028,476.297890,500.893033},
                {463.497272,484.947187,509.755091},
                {471.952105,493.590252,518.608884},
                {480.402653,502.227261,527.454643},
                {488.849033,510.858382,536.292593},
                {497.291360,519.483776,545.122945},
                {505.729742,528.103595,553.945902},
                {514.164283,536.717985,562.761658},
                {522.595081,545.327088,571.570400},
                {531.022232,553.931038,580.372304},
                {539.445827,562.529962,589.167543},
                {547.865954,571.123985,597.956278},
                {556.282696,579.713224,606.738668},
                {564.696133,588.297794,615.514863},
                {573.106344,596.877804,624.285007},
                {581.513402,605.453359,633.049241},
                {589.917379,614.024560,641.807697},
                {598.318344,622.591504,650.560506},
                {606.716363,631.154285,659.307792},
                {615.111501,639.712994,668.049674},
                {623.503819,648.267717,676.786268},
                {631.893377,656.818539,685.517685},
                {640.280231,665.365541,694.244033},
                {648.664438,673.908801,702.965416},
                {657.046051,682.448396,711.681935},
                {665.425122,690.984397,720.393687},
                {673.801702,699.516877,729.100765},
                {682.175838,708.045904,737.803260},
                {690.547577,716.571543,746.501260},
                {698.916966,725.093860,755.194851},
                {707.284047,733.612916,763.884116},
                {715.648865,742.128772,772.569133},
                {724.011460,750.641486,781.249981},
                {732.371872,759.151114,789.926734},
                {740.730140,767.657713,798.599467},
                {749.086302,776.161336,807.268249},
                {757.440395,784.662033,815.933149},
                {765.792455,793.159856,824.594235},
                {774.142515,801.654854,833.251571},
                {782.490610,810.147074,841.905220},
                {790.836773,818.636562,850.555244},
                {799.181035,827.123364,859.201702},
                {807.523427,835.607522,867.844652},
                {815.863980,844.089081,876.484151},
                {824.202723,852.568080,885.120254},
                {832.539683,861.044561,893.753014},
                {840.874890,869.518563,902.382484},
                {849.208371,877.990124,911.008714},
                {857.540150,886.459281,919.631754},
                {865.870255,894.926072,928.251652},
                {874.198711,903.390530,936.868455},
                {882.525542,911.852692,945.482209},
                {890.850771,920.312590,954.092959},
                {899.174423,928.770257,962.700748},
                {907.496520,937.225727,971.305620},
                {915.817083,945.679029,979.907615},
                {924.136136,954.130196,988.506774},
                {932.453699,962.579256,997.103138},
                {940.769792,971.026239,1005.696745},
                {949.084436,979.471173,1014.287632},
                {957.397650,987.914086,1022.875837},
                {965.709455,996.355007,1031.461397},
                {974.019868,1004.793960,1040.044345},
                {982.328909,1013.230973,1048.624718},
                {990.636595,1021.666071,1057.202548},
                {998.942943,1030.099279,1065.777870},
                {1007.247973,1038.530621,1074.350715},
                {1015.551699,1046.960121,1082.921115},
                {1023.854139,1055.387803,1091.489101},
                {1032.155309,1063.813689,1100.054703},
                {1040.455224,1072.237803,1108.617952},
                {1048.753901,1080.660165,1117.178876},
                {1057.051355,1089.080797,1125.737504},
                {1065.347600,1097.499721,1134.293864},
                {1073.642651,1105.916958,1142.847984},
                {1081.936522,1114.332526,1151.399890},
                {1090.229228,1122.746447,1159.949608},
                {1098.520782,1131.158739,1168.497164},
                {1106.811198,1139.569422,1177.042584},
                {1115.100488,1147.978514,1185.585893},
                {1123.388667,1156.386035,1194.127114},
                {1131.675746,1164.792001,1202.666272},
                {1139.961738,1173.196430,1211.203390},
                {1148.246656,1181.599340,1219.738491},
                {1156.530510,1190.000748,1228.271598},
                {1164.813314,1198.400670,1236.802732},
                {1173.095079,1206.799123,1245.331916},
                {1181.375816,1215.196122,1253.859171},
                {1189.655537,1223.591685,1262.384517},
                {1197.934251,1231.985825,1270.907976},
                {1206.211971,1240.378559,1279.429567},
                {1214.488706,1248.769901,1287.949311},
                {1222.764467,1257.159866,1296.467226},
                {1231.039265,1265.548468,1304.983333},
                {1239.313108,1273.935723,1313.497649},
                {1247.586008,1282.321642,1322.010194},
                {1255.857974,1290.706241,1330.520985},
                {1264.129015,1299.089533,1339.030041},
                {1272.399140,1307.471530,1347.537379},
                {1280.668360,1315.852247,1356.043016},
                {1288.936683,1324.231695,1364.546969},
                {1297.204117,1332.609888,1373.049255},
                {1305.470672,1340.986837,1381.549890},
                {1313.736356,1349.362555,1390.048891},
                {1322.001179,1357.737055,1398.546274},
                {1330.265147,1366.110347,1407.042053},
                {1338.528269,1374.482443,1415.536245},
                {1346.790554,1382.853355,1424.028865},
                {1355.052009,1391.223094,1432.519928},
                {1363.312643,1399.591671,1441.009447},
                {1371.572462,1407.959097,1449.497438},
                {1379.831474,1416.325382,1457.983916},
                {1388.089688,1424.690538,1466.468893},
                {1396.347110,1433.054574,1474.952384},
                {1404.603747,1441.417501,1483.434402},
                {1412.859607,1449.779329,1491.914961},
                {1421.114696,1458.140068,1500.394073},
                {1429.369022,1466.499727,1508.871753},
                {1437.622591,1474.858316,1517.348012},
                {1445.875411,1483.215846,1525.822864},
                {1454.127487,1491.572324,1534.296320},
                {1462.378826,1499.927761,1542.768393},
                {1470.629435,1508.282164,1551.239094},
                {1478.879320,1516.635545,1559.708437},
                {1487.128487,1524.987910,1568.176432},
                {1495.376943,1533.339269,1576.643091},
                {1503.624693,1541.689630,1585.108426},
                {1511.871743,1550.039003,1593.572447},
                {1520.118099,1558.387394,1602.035166},
                {1528.363768,1566.734813,1610.496593},
                {1536.608754,1575.081267,1618.956740},
                {1544.853064,1583.426765,1627.415616},
                {1553.096703,1591.771314,1635.873234},
                {1561.339677,1600.114923,1644.329601},
                {1569.581991,1608.457598,1652.784730},
                {1577.823649,1616.799347,1661.238630},
                {1586.064659,1625.140178,1669.691310},
                {1594.305024,1633.480099,1678.142781},
                {1602.544750,1641.819115,1686.593053},
                {1610.783843,1650.157236,1695.042134},
                {1619.022306,1658.494467,1703.490034},
                {1627.260145,1666.830815,1711.936763},
                {1635.497365,1675.166289,1720.382329},
                {1643.733971,1683.500893,1728.826742},
                {1651.969967,1691.834636,1737.270010},
                {1660.205358,1700.167523,1745.712143},
                {1668.440149,1708.499562,1754.153149},
                {1676.674344,1716.830758,1762.593036},
                {1684.907948,1725.161118,1771.031813},
                {1693.140965,1733.490649,1779.469489},
                {1701.373400,1741.819356,1787.906071},
                {1709.605257,1750.147246,1796.341568},
                {1717.836540,1758.474325,1804.775988},
                {1726.067253,1766.800599,1813.209339},
                {1734.297401,1775.126073,1821.641629},
                {1742.526989,1783.450754,1830.072864},
                {1750.756019,1791.774647,1838.503054},
                {1758.984496,1800.097758,1846.932206},
                {1767.212424,1808.420093,1855.360327},
                {1775.439806,1816.741657,1863.787424},
                {1783.666648,1825.062456,1872.213505},
                {1791.892952,1833.382494,1880.638577},
                {1800.118723,1841.701779,1889.062648},
                {1808.343964,1850.020314,1897.485723},
                {1816.568678,1858.338106,1905.907811},
                {1824.792871,1866.655158,1914.328918},
                {1833.016544,1874.971478,1922.749051},
                {1841.239702,1883.287068,1931.168216},
                {1849.462349,1891.601935,1939.586421},
                {1857.684487,1899.916084,1948.003672},
                {1865.906121,1908.229519,1956.419975},
                {1874.127253,1916.542245,1964.835337},
                {1882.347888,1924.854267,1973.249764},
                {1890.568028,1933.165590,1981.663262},
                {1898.787677,1941.476218,1990.075838},
                {1907.006837,1949.786156,1998.487498},
                {1915.225513,1958.095409,2006.898247},
                {1923.443708,1966.403981,2015.308093},
                {1931.661424,1974.711877,2023.717040},
                {1939.878665,1983.019100,2032.125095},
                {1948.095433,1991.325656,2040.532264},
                {1956.311733,1999.631549,2048.938552},
                {1964.527567,2007.936783,2057.343964},
                {1972.742937,2016.241362,2065.748508},
                {1980.957848,2024.545290,2074.152187},
                {1989.172301,2032.848572,2082.555009},
                {1997.386300,2041.151212,2090.956977},
                {2005.599848,2049.453214,2099.358098},
                {2013.812947,2057.754581,2107.758376},
                {2022.025601,2066.055318,2116.157818},
                {2030.237812,2074.355429,2124.556428},
                {2038.449582,2082.654918,2132.954212},
                {2046.660915,2090.953788,2141.351175},
                {2054.871814,2099.252043,2149.747321},
                {2063.082280,2107.549687,2158.142655},
                {2071.292317,2115.846725,2166.537184},
                {2079.501927,2124.143158,2174.930911},
                {2087.711113,2132.438992,2183.323842},
                {2095.919877,2140.734230,2191.715981},
                {2104.128222,2149.028875,2200.107333},
                {2112.336151,2157.322931,2208.497902},
                {2120.543665,2165.616402,2216.887695},
                {2128.750768,2173.909290,2225.276714},
                {2136.957462,2182.201600,2233.664965},
                {2145.163749,2190.493334,2242.052452},
                {2153.369631,2198.784497,2250.439180}};


u16 bytes_input;
u16 bytes_output;
byte *message, *hash;

void iter_begin(char *dllhashname) {


    bytes_input=64/8;
    bytes_output=64/8;

    message=(byte*)malloc(bytes_input);
    hash=(byte*)malloc(bytes_output);
    if(message==NULL || hash==NULL) {
        printf("Can not allocate memory for essential buffers.\n");
        exit(EXIT_FAILURE);
    }

    printf("identifier = %s\ninput bits = %i\noutput bits = %i\n\n",
            "HASH_NAME", 64, 64);
    printf("0%%  10%%  20%%  30%%  40%%  50%%  60%%  70%%  80%%  90%%  100%%\n");

}

void iter_end() {

    //free(message);
    //free(hash);
}


int mobiusMain(int argc, char *argv[]) {
    int n;
    int k;
    int i, j;
    u16 data[3] = {0, 1, 2}; /* maximum of k is 3 (following the paper cited) */
    u16 bits_input;
    u16 bits_output;
    u32 *nk; /* table of bits_output counters for numbers of monomials with
	      degree k, for each output bit */
    double tmp;
    u32 klasa[3];
    byte *au;
    u32 iterations, lastick;
    double onetick;
    double nkexpect, ndouble, dsquare;

    if (argc != 3) {
        printf("\n%s [1|2|3] hash.dll\n\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    if (strcmp(argv[1], "2") == 0) {
        k = 2;
    } else if (strcmp(argv[1], "3") == 0) {
        k = 3;
    } else {
        k = 1;
    }

    printf("\nDEGREE=%u Mobius ANF Analysis on:\n\n", k);

    /* Prepare the hash function for usage */
    iter_begin(argv[2]);

    bits_input = bytes_input * 8;
    bits_output = bytes_output * 8;
    /* set the combination parametars ( C(n,k) )*/
    n = bits_input;

    /* the total number of iterations is needed for the progress bar */
    if (k == 1)
        iterations = n;
    else if (k == 2)
        iterations = n * (n - 1) / 2;
    else
        iterations = n * (n - 1) * (n - 2) / 6;

    onetick = (double) iterations / (double) 53;
    lastick = 1;

    /* allocate memory and set the counters to 0 */
    nk = (u32 *) malloc(sizeof(u32) * bits_output);
    for (i = 0; i < bits_output; i++) nk[i] = 0;
    au = (byte *) malloc(bytes_output);

    /*   for(i=0; i<k; i++)  */
    /*     printf("%u ", data[i]); */
    /*   printf("\n"); */

    /* The main loop consists of gereating combinations for 'u',
     * and enumerating the number of monomials with degree k */
    iterations = 0;
    while (1) {
        if (lastick != (u32)((double) iterations / onetick)) {
            printf("."); /* output progress */
            fflush(stdout);
            lastick = (u32)((double) iterations / onetick);
        }
        ++iterations;

        if (k == 1) {
            zeroize(message, bytes_input);
            hash_transform(message, hash);
            memcpy(au, hash, bytes_output); /* a_u = f(o) */
            //	  print_bits(message, bytes_input);
            //	  print_bits(hash, bytes_output);
            //	  print_bits(au, bytes_output);

            modify_bit(message, data[0]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* a_u = a_u XOR f(e_i_1) */
            //	  print_bits(message, bytes_input);
            //	  print_bits(hash, bytes_output);
            //	  print_bits(au, bytes_output);

            for (j = 0; j < bits_output; j++) nk[j] += get_bit(au, j);

        } else if (k == 2) {
            zeroize(message, bytes_input);
            hash_transform(message, hash);
            memcpy(au, hash, bytes_output); /* a_u = f(o) */

            modify_bit(message, data[0]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* a_u = a_u XOR f(e_i_1) */

            zeroize(message, bytes_input);
            modify_bit(message, data[1]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* a_u = a_u XOR f(e_i_2) */

            modify_bit(message, data[0]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* a_u = a_u XOR f(e_i_1 XOR e_i_2) */

            for (j = 0; j < bits_output; j++) nk[j] += get_bit(au, j);

        } else { /* k==3 */
            zeroize(message, bytes_input);
            hash_transform(message, hash);
            memcpy(au, hash, bytes_output); /* a_u = f(o) */

            modify_bit(message, data[0]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* a_u = a_u XOR f(e_i_1) */

            zeroize(message, bytes_input);
            modify_bit(message, data[1]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* a_u = a_u XOR f(e_i_2) */

            zeroize(message, bytes_input);
            modify_bit(message, data[2]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* a_u = a_u XOR f(e_i_3) */

            zeroize(message, bytes_input);
            modify_bit(message, data[0]);
            modify_bit(message, data[1]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* ... e_i_1+e_i_2 */

            zeroize(message, bytes_input);
            modify_bit(message, data[0]);
            modify_bit(message, data[2]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* ... e_i_1+e_i_3 */

            zeroize(message, bytes_input);
            modify_bit(message, data[1]);
            modify_bit(message, data[2]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* ... e_i_3+e_i_2 */

            modify_bit(message, data[0]);
            hash_transform(message, hash);
            memxor(au, hash, bytes_output); /* ... e_i_3+e_i_2+e_i_1 */

            for (j = 0; j < bits_output; j++) nk[j] += get_bit(au, j);

        }

        /* generate the next combination */
        i = k - 1;
        while (i > 0 && data[i] == n - k + i) i--;
        if (i == 0 && data[i] == n - k) break;
        data[i]++;
        for (; i < k - 1; i++) data[i + 1] = data[i] + 1;

        /*     for(i=0; i<k; i++)  */
        /*       printf("%u ", data[i]); */
        /*     printf("\n"); */
    }

    printf("\n\n%lu iterations; %lu hash calculations\n\n", iterations, iterations * (1 << k));

    //  for(j=0; j<bits_output; j++) printf("%u ", nk[j]);
    //  printf("\n");

    ndouble = (double) n;
    if (k == 1)
        nkexpect = ndouble / 2.0;
    else if (k == 2)
        nkexpect = (ndouble - 1.0) * ndouble / 4.0;
    else /* k==3 */
        nkexpect = (ndouble - 2.0) * (ndouble - 1.0) * ndouble / 12.0;

    dsquare = 0.0;
    for (i = 0; i < bits_output; i++)
        dsquare += ((nkexpect - (double) nk[i]) * (nkexpect - (double) nk[i]) / nkexpect);
    printf("T_1^%u D^2==%lf\n", k, dsquare);

    printf("    chi^2==%fl  =>  %s for significance alpha==0.05\n",
            chi_square_8to2048[bytes_output - 1][0],
            (dsquare <= chi_square_8to2048[bytes_output - 1][0] ? "PASSED" : "FAILED"));
    printf("    chi^2==%fl  =>  %s for significance alpha==0.01\n",
            chi_square_8to2048[bytes_output - 1][1],
            (dsquare <= chi_square_8to2048[bytes_output - 1][1] ? "PASSED" : "FAILED"));
    printf("    chi^2==%fl  =>  %s for significance alpha==0.001\n",
            chi_square_8to2048[bytes_output - 1][2],
            (dsquare <= chi_square_8to2048[bytes_output - 1][2] ? "PASSED" : "FAILED"));


    /* We make 3 classes of frequencies of output ANFs (anfsdefs.c) */
    klasa[0] = klasa[1] = klasa[2] = 0;
    for (i = 0; i < bits_output; i++)
        // ako e vo prvata klasa
        if ((double) nk[i] <= class_delimiters[k - 1][bytes_input - 1][0]) {
            ++klasa[0];
        }
            // ako e vo tretata klasa
        else if ((double) nk[i] >= class_delimiters[k - 1][bytes_input - 1][1]) {
            ++klasa[2];
        }
            // ako e vo srednata (vtorata klasa)
        else {
            ++klasa[1];
        }

    //printf("%lu %lu %lu\n", klasa[0], klasa[1], klasa[2]);
    //printf("%lf %lf %lf\n", 30.0/160.0*bits_output, 100.0/160.0*bits_output, 30.0/160.0*bits_output);
    printf("\n");
    dsquare = 0.0;
    tmp = 30.0 / 160.0 * bits_output;
    dsquare += ((tmp - (double) klasa[0]) * (tmp - (double) klasa[0]) / tmp);
    dsquare += ((tmp - (double) klasa[2]) * (tmp - (double) klasa[2]) / tmp);
    tmp = 100.0 / 160.0 * bits_output;
    dsquare += ((tmp - (double) klasa[1]) * (tmp - (double) klasa[1]) / tmp);

    printf("T_2^%u D^2==%lf\n", k, dsquare);
    printf("    chi^2==%fl  =>  %s for significance alpha==0.05\n",
            chi_square_2[0],
            (dsquare <= chi_square_2[0] ? "PASSED" : "FAILED"));
    printf("    chi^2==%fl  =>  %s for significance alpha==0.01\n",
            chi_square_2[1],
            (dsquare <= chi_square_2[1] ? "PASSED" : "FAILED"));
    printf("    chi^2==%fl  =>  %s for significance alpha==0.001\n",
            chi_square_2[2],
            (dsquare <= chi_square_2[2] ? "PASSED" : "FAILED"));

    /* shut down the hash function*/
    iter_end();

    free(nk);
    free(au);

    return EXIT_SUCCESS;
}
#endif	/* MOBIUS_HPP */